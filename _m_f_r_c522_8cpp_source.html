<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>MFRC522: MFRC522.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MFRC522
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_m_f_r_c522_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MFRC522.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_m_f_r_c522_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_m_f_r_c522_8hpp.html">MFRC522.hpp</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno"><a class="line" href="namespace_m_f_r_c.html">    2</a></span>&#160;<span class="keyword">namespace </span>MFRC {</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">    4</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">MFRC522::PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg, uint8_t value)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    _spi.nssLow();</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    _spi.send(reg);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    _spi.send(value);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    _spi.nssHigh();</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a087518df749ac13980f1b7aa075350d2">   12</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">MFRC522::PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg, uint8_t count, uint8_t *values)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    _spi.nssLow();</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    _spi.send(reg);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; count; i++)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        _spi.send(values[index]);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    _spi.nssHigh();</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">   22</a></span>&#160;uint8_t <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">MFRC522::PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    uint8_t value;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    _spi.nssLow();</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    value = _spi.transfer(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1839f9049091b1c113ad4432768ac39e">readReg</a>(reg)) &amp; 0xFF; <span class="comment">// MSB := 1 for reading. LSB is not used in address. See 8.1.2.3.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    _spi.send(0); <span class="comment">// Send 0 to stop reading.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    _spi.nssHigh();</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">return</span> value;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a9649953537c252a9572b8d843c3646ca">   32</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">MFRC522::PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg, uint8_t count, uint8_t *values, uint8_t rxAlign)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (!count)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    uint8_t address = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1839f9049091b1c113ad4432768ac39e">readReg</a>(reg);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    uint8_t index = 0;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    _spi.nssLow();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    count--;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    _spi.send(address);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">if</span> (rxAlign) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        uint8_t mask = (0xFF &lt;&lt; rxAlign) &amp; 0xFF;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        uint8_t value = _spi.transfer(address);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        values[0] = (values[0] &amp; ~mask) | (value &amp; mask);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        index++;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">for</span> (index; index &lt; count; index++) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        values[index] = _spi.transfer(address);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        index++;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    values[index] = _spi.transfer(address);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    _spi.nssHigh();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#ae67c3d632e2cd9f02c79d5ab04e3b6d7">   59</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ae67c3d632e2cd9f02c79d5ab04e3b6d7">MFRC522::PCD_SetRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg, uint8_t mask)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;{</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    uint8_t tmp;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    tmp = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(reg);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(reg, tmp | mask);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">   66</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">MFRC522::PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">PCDRegister</a> reg, uint8_t mask)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    uint8_t tmp;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    tmp = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(reg);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(reg, tmp &amp; (~mask));</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">   73</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">MFRC522::PCD_CalculateCRC</a>(uint8_t *data, uint8_t length, uint8_t *result)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303">PCD_Idle</a>);        <span class="comment">// Stop any active command.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a7892fc58b473802b634afaefd31bbe00">DivIrqReg</a>, 0x04);             <span class="comment">// Clear the CRCIRq interrupt request bit</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">FIFOLevelReg</a>, 0x80);          <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, length, data);   <span class="comment">// Write data to the FIFO</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84ab6d5e8852271ce88cdc8645f18b0a0a4">PCD_CalcCRC</a>);     <span class="comment">// Start the calculation</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// Wait for the CRC calculation to complete. Each iteration of the while-loop takes 17.73μs.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// TODO check/modify for other architectures than Arduino Uno 16bit</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// Wait for the CRC calculation to complete. Each iteration of the while-loop takes 17.73us.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 5000; i &gt; 0; i--) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">// DivIrqReg[7..0] bits are: Set2 reserved reserved MfinActIRq reserved CRCIRq reserved reserved</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        uint8_t n = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a7892fc58b473802b634afaefd31bbe00">DivIrqReg</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> (n &amp; 0x04) {                                 <span class="comment">// CRCIRq bit set - calculation done</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303">PCD_Idle</a>);    <span class="comment">// Stop calculating CRC for new content in the FIFO.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="comment">// Transfer the result from the registers to the result buffer</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            result[0] = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a212643c14a322159fc706abdc0481912">CRCResultRegL</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            result[1] = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a405f8573d81d63d4dedbdb45c40f816c">CRCResultRegH</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// 89ms passed and nothing happend. Communication with the MFRC522 might be down.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7977fc7aca1707b43acec4d7a10239fe">  100</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7977fc7aca1707b43acec4d7a10239fe">MFRC522::PCD_Init</a>() {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">bool</span> hardReset = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// Set the chipSelectPin as digital output, do not select the slave yet</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    pinMode(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a2e840a158b013e104751894b18493b59">_chipSelectPin</a>, OUTPUT);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    digitalWrite(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a2e840a158b013e104751894b18493b59">_chipSelectPin</a>, HIGH);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// If a valid pin number has been set, pull device out of power down / reset state.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a> != UNUSED_PIN) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// First set the resetPowerDownPin as digital input, to check the MFRC522 power down mode.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        pinMode(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a>, INPUT);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (digitalRead(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a>) == LOW) {   <span class="comment">// The MFRC522 chip is in power down mode.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            pinMode(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a>, OUTPUT);        <span class="comment">// Now set the resetPowerDownPin as digital output.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            digitalWrite(<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a>, HIGH);     <span class="comment">// Exit power down mode. This triggers a hard reset.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="comment">// Section 8.8.2 in the datasheet says the oscillator start-up time is the start up time of the crystal + 37,74μs. Let us be generous: 50ms.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            delay(50);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            hardReset = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (!hardReset) { <span class="comment">// Perform a soft reset if we haven&#39;t triggered a hard reset above.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa627ac387b7b81a55eb65d69f0d6cd51">PCD_Reset</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// Reset baud rates</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae3d612e672d6744b5d42be5431051c4f">TxModeReg</a>, 0x00);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4130d37867b7dd3c1b02f59bf6959cb1">RxModeReg</a>, 0x00);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// Reset ModWidthReg</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae85967fc09d21a10fdf99a2717c7f3f6">ModWidthReg</a>, 0x26);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// When communicating with a PICC we need a timeout if something goes wrong.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// f_timer = 13.56 MHz / (2*TPreScaler+1) where TPreScaler = [TPrescaler_Hi:TPrescaler_Lo].</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// TPrescaler_Hi are the four low bits in TModeReg. TPrescaler_Lo is TPrescalerReg.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a0be7e8b1c68eeedcfe4791c1f93311d8">TModeReg</a>, 0x80);          <span class="comment">// TAuto=1; timer starts automatically at the end of the transmission in all communication modes at all speeds</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a237cdeaf894c23f3b97eccb8b1bb1479">TPrescalerReg</a>, 0xA9);     <span class="comment">// TPreScaler = TModeReg[3..0]:TPrescalerReg, ie 0x0A9 = 169 =&gt; f_timer=40kHz, ie a timer period of 25μs.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638acd32b2f19f1ff8fa06c27e80905889db">TReloadRegH</a>, 0x03);       <span class="comment">// Reload timer with 0x3E8 = 1000, ie 25ms before timeout.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae16c48cbed59486a669365b7f40150ab">TReloadRegL</a>, 0xE8);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638aaf12350510a933a6f206df6b61ca2f50">TxASKReg</a>, 0x40);      <span class="comment">// Default 0x00. Force a 100 % ASK modulation independent of the ModGsPReg register setting</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a23737bf73ba9ce1cd431609c8ad992c4">ModeReg</a>, 0x3D);       <span class="comment">// Default 0x3F. Set the preset value for the CRC coprocessor for the CalcCRC command to 0x6363 (ISO 14443-3 part 6.2.4)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1bf8022c74614356b2b0350570bac64d">PCD_AntennaOn</a>();                        <span class="comment">// Enable the antenna driver pins TX1 and TX2 (they were disabled by the reset)</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a81e0d0095a0a5d4a2cf38b3f0fe17327">  144</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7977fc7aca1707b43acec4d7a10239fe">MFRC522::PCD_Init</a>(uint8_t chipSelectPin, uint8_t resetPowerDownPin)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a2e840a158b013e104751894b18493b59">_chipSelectPin</a> = chipSelectPin;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">_resetPowerDownPin</a> = resetPowerDownPin;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// Set the chipSelectPin as digital output, do not select the slave yet</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7977fc7aca1707b43acec4d7a10239fe">PCD_Init</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa627ac387b7b81a55eb65d69f0d6cd51">  152</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa627ac387b7b81a55eb65d69f0d6cd51">MFRC522::PCD_Reset</a>()</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a05f524febfef65b7f8254e3fcadf0f34">PCD_SoftReset</a>);   <span class="comment">// Issue the SoftReset command.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// The datasheet does not mention how long the SoftRest command takes to complete.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// But the MFRC522 might have been in soft power-down mode (triggered by bit 4 of CommandReg) </span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// Section 8.8.2 in the datasheet says the oscillator start-up time is the start up time of the crystal + 37,74μs. Let us be generous: 50ms.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    uint8_t count = 0;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">// Wait for the PowerDown bit in CommandReg to be cleared (max 3x50ms)</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        delay(50);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    } <span class="keywordflow">while</span> ((<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>) &amp; (1 &lt;&lt; 4)) &amp;&amp; (++count) &lt; 3);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1bf8022c74614356b2b0350570bac64d">  165</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1bf8022c74614356b2b0350570bac64d">MFRC522::PCD_AntennaOn</a>()</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    uint8_t value = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a6c8f580c01ab6001603875bff483c9ef">TxControlReg</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> ((value &amp; 0x03) != 0x03) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a6c8f580c01ab6001603875bff483c9ef">TxControlReg</a>, value | 0x03);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1ec04dca980c7cfcad234fb74f241369">  173</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1ec04dca980c7cfcad234fb74f241369">MFRC522::PCD_AntennaOff</a>()</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a6c8f580c01ab6001603875bff483c9ef">TxControlReg</a>, 0x03);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a60bd31a2011cb66ebd99f660ba7b5d69">  178</a></span>&#160;uint8_t <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a60bd31a2011cb66ebd99f660ba7b5d69">MFRC522::PCD_GetAntennaGain</a>()</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;{</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a2e8033091c806e68d5715040aa056a03">RFCfgReg</a>) &amp; (0x07&lt;&lt;4);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a81ead771fb7925af374f84962a1b118f">  183</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a81ead771fb7925af374f84962a1b118f">MFRC522::PCD_SetAntennaGain</a>(uint8_t mask)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a60bd31a2011cb66ebd99f660ba7b5d69">PCD_GetAntennaGain</a>() != mask) {                     <span class="comment">// only bother if there is a change</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a2e8033091c806e68d5715040aa056a03">RFCfgReg</a>, (0x07&lt;&lt;4));      <span class="comment">// clear needed to allow 000 pattern</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ae67c3d632e2cd9f02c79d5ab04e3b6d7">PCD_SetRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a2e8033091c806e68d5715040aa056a03">RFCfgReg</a>, mask &amp; (0x07&lt;&lt;4)); <span class="comment">// only set RxGain[2:0] bits</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1408fd1b9df3230f04609515ae28780a">  191</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1408fd1b9df3230f04609515ae28780a">MFRC522::PCD_PerformSelfTest</a>() {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// This follows directly the steps outlined in 16.1.1</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// 1. Perform a soft reset.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa627ac387b7b81a55eb65d69f0d6cd51">PCD_Reset</a>();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// 2. Clear the internal buffer by writing 25 bytes of 00h</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    uint8_t ZEROES[25] = {0x00};</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">FIFOLevelReg</a>, 0x80);      <span class="comment">// flush the FIFO buffer</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, 25, ZEROES); <span class="comment">// write 25 bytes of 00h to FIFO</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a285acb7d0736b5afc92ea6560fe329be">PCD_Mem</a>);     <span class="comment">// transfer to internal buffer</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// 3. Enable self-test</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a9ff9256cf4bb95b3434218c6eec62cb1">AutoTestReg</a>, 0x09);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// 4. Write 00h to FIFO buffer</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, 0x00);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// 5. Start self-test by issuing the CalcCRC command</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84ab6d5e8852271ce88cdc8645f18b0a0a4">PCD_CalcCRC</a>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// 6. Wait for self-test to complete</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    uint8_t n;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 0xFF; i++) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">// The datasheet does not specify exact completion condition except</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">// that FIFO buffer should contain 64 bytes.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// While selftest is initiated by CalcCRC command</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">// it behaves differently from normal CRC computation,</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">// so one can&#39;t reliably use DivIrqReg to check for completion.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">// It is reported that some devices does not trigger CRCIRq flag</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">// during selftest.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        n = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">FIFOLevelReg</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">if</span> (n &gt;= 64) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303">PCD_Idle</a>);        <span class="comment">// Stop calculating CRC for new content in the FIFO.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// 7. Read out resulting 64 bytes from the FIFO buffer.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    uint8_t result[64];</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, 64, result, 0);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// Auto self-test done</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// Reset AutoTestReg register to be 0 again. Required for normal operation.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a9ff9256cf4bb95b3434218c6eec62cb1">AutoTestReg</a>, 0x00);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// Determine firmware version (see section 9.3.4.8 in spec)</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    uint8_t version = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4c239ecd6090284f00aaf1770acca869">VersionReg</a>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// Pick the appropriate reference values</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">const</span> uint8_t *reference;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">switch</span> (version) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">case</span> 0x88:  <span class="comment">// Fudan Semiconductor FM17522 clone</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            reference = FM17522_firmware_reference;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">case</span> 0x90:  <span class="comment">// Version 0.0</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            reference = MFRC522_firmware_referenceV0_0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">case</span> 0x91:  <span class="comment">// Version 1.0</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            reference = MFRC522_firmware_referenceV1_0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">case</span> 0x92:  <span class="comment">// Version 2.0</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            reference = MFRC522_firmware_referenceV2_0;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">default</span>:    <span class="comment">// Unknown version</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// abort test</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// Verify that the results match up to our expectations</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 64; i++) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (result[i] != pgm_read_byte(&amp;(reference[i]))) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// Test passed; all is good.</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">//IMPORTANT NOTE!!!!</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">//Calling any other function that uses CommandReg will disable soft power down mode !!!</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">//For more details about power control, refer to the datasheet - page 33 (8.6)</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aaaa8197345d434273f673318abba1d0f">  273</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aaaa8197345d434273f673318abba1d0f">MFRC522::PCD_SoftPowerDown</a>()</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">//Note : Only soft power down mode is available throught software</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    uint8_t val = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>); <span class="comment">// Read state of the command register </span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    val |= (1&lt;&lt;4);<span class="comment">// set PowerDown bit ( bit 4 ) to 1 </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, val);<span class="comment">//write new value to the command register</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#abc5785a1ab77bfef495a18b8be64d716">  281</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#abc5785a1ab77bfef495a18b8be64d716">MFRC522::PCD_SoftPowerUp</a>()</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    uint8_t val = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>); <span class="comment">// Read state of the command register </span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    val &amp;= ~(1&lt;&lt;4);<span class="comment">// set PowerDown bit ( bit 4 ) to 0 </span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, val);<span class="comment">//write new value to the command register</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// wait until PowerDown bit is cleared (this indicates end of wake up procedure) </span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keyword">const</span> uint32_t timeout = (uint32_t)millis() + 500;<span class="comment">// create timer for timeout (just in case) </span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">while</span>(millis()&lt;=timeout){ <span class="comment">// set timeout to 500 ms </span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        val = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>);<span class="comment">// Read state of the command register</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span>(!(val &amp; (1&lt;&lt;4))){ <span class="comment">// if powerdown bit is 0 </span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">break</span>;<span class="comment">// wake up procedure is finished </span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">  297</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">MFRC522::PCD_TransceiveData</a>(uint8_t *sendData, uint8_t sendLen, uint8_t *backData, uint8_t *backLen, uint8_t *validBits, uint8_t rxAlign, <span class="keywordtype">bool</span> checkCRC)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    uint8_t waitIRq = 0x30;        <span class="comment">// RxIRq and IdleIRq</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">PCD_CommunicateWithPICC</a>(<a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12">PCD_Transceive</a>, waitIRq, sendData, sendLen, backData, backLen, validBits, rxAlign, checkCRC);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">  303</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">MFRC522::PCD_CommunicateWithPICC</a>(uint8_t command, uint8_t waitIRq, uint8_t *sendData, uint8_t sendLen, uint8_t *backData, uint8_t *backLen, uint8_t *validBits, uint8_t rxAlign, <span class="keywordtype">bool</span> checkCRC)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// Prepare values for BitFramingReg</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    uint8_t txLastBits = validBits ? *validBits : 0;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    uint8_t bitFraming = (rxAlign &lt;&lt; 4) + txLastBits;      <span class="comment">// RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303">PCD_Idle</a>);            <span class="comment">// Stop any active command.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a1db3ec7619e0d21b8dfb996d4ddeeda4">ComIrqReg</a>, 0x7F);                 <span class="comment">// Clear all seven interrupt request bits</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">FIFOLevelReg</a>, 0x80);              <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, sendLen, sendData);  <span class="comment">// Write sendData to the FIFO</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a3f2ed081137698e3d6c2c11dfd5129e4">BitFramingReg</a>, bitFraming);       <span class="comment">// Bit adjustments</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">CommandReg</a>, command);             <span class="comment">// Execute the command</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (command == <a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12">PCD_Transceive</a>) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ae67c3d632e2cd9f02c79d5ab04e3b6d7">PCD_SetRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a3f2ed081137698e3d6c2c11dfd5129e4">BitFramingReg</a>, 0x80);    <span class="comment">// StartSend=1, transmission of data starts</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// Wait for the command to complete.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// In PCD_Init() we set the TAuto flag in TModeReg. This means the timer automatically starts when the PCD stops transmitting.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// Each iteration of the do-while-loop takes 17.86μs.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// TODO check/modify for other architectures than Arduino Uno 16bit</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    uint16_t i;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">for</span> (i = 2000; i &gt; 0; i--) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        uint8_t n = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a1db3ec7619e0d21b8dfb996d4ddeeda4">ComIrqReg</a>);   <span class="comment">// ComIrqReg[7..0] bits are: Set1 TxIRq RxIRq IdleIRq HiAlertIRq LoAlertIRq ErrIRq TimerIRq</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> (n &amp; waitIRq) {                  <span class="comment">// One of the interrupts that signal success has been set.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span> (n &amp; 0x01) {                     <span class="comment">// Timer interrupt - nothing received in 25ms</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// 35.7ms and nothing happend. Communication with the MFRC522 might be down.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// Stop now if any errors except collisions were detected.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    uint8_t errorRegValue = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638aa66722964ad21187ec3874c513c04718">ErrorReg</a>); <span class="comment">// ErrorReg[7..0] bits are: WrErr TempErr reserved BufferOvfl CollErr CRCErr ParityErr ProtocolErr</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (errorRegValue &amp; 0x13) {  <span class="comment">// BufferOvfl ParityErr ProtocolErr</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">STATUS_ERROR</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    uint8_t _validBits = 0;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// If the caller wants data back, get it from the MFRC522.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (backData &amp;&amp; backLen) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        uint8_t n = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">FIFOLevelReg</a>);    <span class="comment">// Number of bytes in the FIFO</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span> (n &gt; *backLen) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da98e879872e3b5f18fb1ad1cccc8a7bc8">STATUS_NO_ROOM</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        *backLen = n;                                           <span class="comment">// Number of bytes returned</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">FIFODataReg</a>, n, backData, rxAlign);    <span class="comment">// Get received data from FIFO</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        _validBits = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a1148f8c668fcd879ff66e69d3de5ef33">ControlReg</a>) &amp; 0x07;       <span class="comment">// RxLastBits[2:0] indicates the number of valid bits in the last received byte. If this value is 000b, the whole byte is valid.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">if</span> (validBits) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            *validBits = _validBits;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// Tell about collisions</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (errorRegValue &amp; 0x08) {     <span class="comment">// CollErr</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7daa6a6fd953277959b0b8f5ea3fe9252fb">STATUS_COLLISION</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// Perform CRC_A validation if requested.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (backData &amp;&amp; backLen &amp;&amp; checkCRC) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">// In this case a MIFARE Classic NAK is not OK.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span> (*backLen == 1 &amp;&amp; _validBits == 4) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dafef3c30148ab31624276e58198e067f2">STATUS_MIFARE_NACK</a>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">// We need at least the CRC_A value and all 8 bits of the last byte must be received.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">if</span> (*backLen &lt; 2 || _validBits != 0) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da5c0024c0ea3716ace67cee7e8d4b280c">STATUS_CRC_WRONG</a>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">// Verify CRC_A - do our own calculation and store the control in controlBuffer.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        uint8_t controlBuffer[2];</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> status = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(&amp;backData[0], *backLen - 2, &amp;controlBuffer[0]);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">if</span> (status != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> ((backData[*backLen - 2] != controlBuffer[0]) || (backData[*backLen - 1] != controlBuffer[1])) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da5c0024c0ea3716ace67cee7e8d4b280c">STATUS_CRC_WRONG</a>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a4f6e40cb3c6b57a699a623bd09d859fc">  389</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a4f6e40cb3c6b57a699a623bd09d859fc">MFRC522::PICC_RequestA</a>(uint8_t *bufferATQA, uint8_t *bufferSize)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;{</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6d6f1dcbfede41160cc84085b08c2fbe">PICC_REQA_or_WUPA</a>(<a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebab7de94a76a70fae4499445c2c48c9add">PICC_CMD_REQA</a>, bufferATQA, bufferSize);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a414e7dd52abf129e38a3fd7502e0deda">  394</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a414e7dd52abf129e38a3fd7502e0deda">MFRC522::PICC_WakeupA</a>(uint8_t *bufferATQA, uint8_t *bufferSize)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6d6f1dcbfede41160cc84085b08c2fbe">PICC_REQA_or_WUPA</a>(<a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba61672bf29f6679232850bc7c724a6868">PICC_CMD_WUPA</a>, bufferATQA, bufferSize);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6d6f1dcbfede41160cc84085b08c2fbe">  399</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6d6f1dcbfede41160cc84085b08c2fbe">MFRC522::PICC_REQA_or_WUPA</a>(uint8_t command, uint8_t *bufferATQA, uint8_t *bufferSize)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    uint8_t validBits;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> status;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> (bufferATQA == <span class="keyword">nullptr</span> || *bufferSize &lt; 2) { <span class="comment">// The ATQA response is 2 bytes long.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da98e879872e3b5f18fb1ad1cccc8a7bc8">STATUS_NO_ROOM</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a55430b019624dd5a86e471c934139089">CollReg</a>, 0x80);        <span class="comment">// ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    validBits = 7;                                  <span class="comment">// For REQA and WUPA we need the short frame format - transmit only 7 bits of the last (and only) byte. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    status = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">PCD_TransceiveData</a>(&amp;command, 1, bufferATQA, bufferSize, &amp;validBits);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (status != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (*bufferSize != 2 || validBits != 0) {       <span class="comment">// ATQA must be exactly 16 bits.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">STATUS_ERROR</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0e85af574de32cd21c41fa6de7bbdff5">  419</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0e85af574de32cd21c41fa6de7bbdff5">MFRC522::PICC_Select</a>(<a class="code" href="struct_m_f_r_c_1_1_uid.html">Uid</a> *uid, uint8_t validBits)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordtype">bool</span> uidComplete;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordtype">bool</span> selectDone;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordtype">bool</span> useCascadeTag;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    uint8_t cascadeLevel = 1;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> result;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    uint8_t count;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    uint8_t checkBit;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    uint8_t index;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    uint8_t uidIndex;                  <span class="comment">// The first index in uid-&gt;uidByte[] that is used in the current Cascade Level.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    int8_t currentLevelKnownBits;       <span class="comment">// The number of known UID bits in the current Cascade Level.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    uint8_t buffer[9];                 <span class="comment">// The SELECT/ANTICOLLISION commands uses a 7 uint8_t standard frame + 2 bytes CRC_A</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    uint8_t bufferUsed;                <span class="comment">// The number of bytes used in the buffer, ie the number of bytes to transfer to the FIFO.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    uint8_t rxAlign;                   <span class="comment">// Used in BitFramingReg. Defines the bit position for the first bit received.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    uint8_t txLastBits;                <span class="comment">// Used in BitFramingReg. The number of valid bits in the last transmitted byte. </span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    uint8_t *responseBuffer;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    uint8_t responseLength;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// Description of buffer structure:</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">//      Byte 0: SEL                 Indicates the Cascade Level: PICC_CMD_SEL_CL1, PICC_CMD_SEL_CL2 or PICC_CMD_SEL_CL3</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">//      Byte 1: NVB                 Number of Valid Bits (in complete command, not just the UID): High nibble: complete bytes, Low nibble: Extra bits. </span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">//      Byte 2: UID-data or CT      See explanation below. CT means Cascade Tag.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">//      Byte 3: UID-data</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">//      Byte 4: UID-data</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">//      Byte 5: UID-data</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">//      Byte 6: BCC                 Block Check Character - XOR of bytes 2-5</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">//      Byte 7: CRC_A</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">//      Byte 8: CRC_A</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// The BCC and CRC_A are only transmitted if we know all the UID bits of the current Cascade Level.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">// Description of bytes 2-5: (Section 6.5.4 of the ISO/IEC 14443-3 draft: UID contents and cascade levels)</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">//      UID size    Cascade level   Byte2   Byte3   Byte4   Byte5</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">//      ========    =============   =====   =====   =====   =====</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">//       4 bytes        1           uid0    uid1    uid2    uid3</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">//       7 bytes        1           CT      uid0    uid1    uid2</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">//                      2           uid3    uid4    uid5    uid6</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">//      10 bytes        1           CT      uid0    uid1    uid2</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">//                      2           CT      uid3    uid4    uid5</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">//                      3           uid6    uid7    uid8    uid9</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// Sanity checks</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (validBits &gt; 80) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf">STATUS_INVALID</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// Prepare MFRC522</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a55430b019624dd5a86e471c934139089">CollReg</a>, 0x80);        <span class="comment">// ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// Repeat Cascade Level loop until we have a complete UID.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    uidComplete = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">while</span> (!uidComplete) {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">// Set the Cascade Level in the SEL byte, find out if we need to use the Cascade Tag in byte 2.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">switch</span> (cascadeLevel) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                buffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba7c2b5038b9c5f7edb7b9ea0e54d85360">PICC_CMD_SEL_CL1</a>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                uidIndex = 0;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                useCascadeTag = validBits &amp;&amp; uid-&gt;<a class="code" href="struct_m_f_r_c_1_1_uid.html#aeb53e15a6acd08d613a607110ea39d35">size</a> &gt; 4; <span class="comment">// When we know that the UID has more than 4 bytes</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                buffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebae622566f65077706b3fabbe057ac931a">PICC_CMD_SEL_CL2</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                uidIndex = 3;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                useCascadeTag = validBits &amp;&amp; uid-&gt;<a class="code" href="struct_m_f_r_c_1_1_uid.html#aeb53e15a6acd08d613a607110ea39d35">size</a> &gt; 7; <span class="comment">// When we know that the UID has more than 7 bytes</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                buffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebab63546886f438df42f2132ae2d2f8828">PICC_CMD_SEL_CL3</a>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                uidIndex = 6;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                useCascadeTag = <span class="keyword">false</span>;                      <span class="comment">// Never used in CL3.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da956a658a552bd53d6e4ed59034d26411">STATUS_INTERNAL_ERROR</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">// How many UID bits are known in this Cascade Level?</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        currentLevelKnownBits = validBits - (8 * uidIndex);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span> (currentLevelKnownBits &lt; 0) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            currentLevelKnownBits = 0;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment">// Copy the known bits from uid-&gt;uidByte[] to buffer[]</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        index = 2; <span class="comment">// destination index in buffer[]</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">if</span> (useCascadeTag) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            buffer[index++] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa426554eaf5c3a0b063718a1210fba91">PICC_CMD_CT</a>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        uint8_t bytesToCopy = currentLevelKnownBits / 8 + (currentLevelKnownBits % 8 ? 1 : 0); <span class="comment">// The number of bytes needed to represent the known bits for this level.</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">if</span> (bytesToCopy) {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            uint8_t maxBytes = useCascadeTag ? 3 : 4; <span class="comment">// Max 4 bytes in each Cascade Level. Only 3 left if we use the Cascade Tag</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">if</span> (bytesToCopy &gt; maxBytes) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                bytesToCopy = maxBytes;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="keywordflow">for</span> (count = 0; count &lt; bytesToCopy; count++) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                buffer[index++] = uid-&gt;uidByte[uidIndex + count];</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment">// Now that the data has been copied we need to include the 8 bits in CT in currentLevelKnownBits</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> (useCascadeTag) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            currentLevelKnownBits += 8;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// Repeat anti collision loop until we can transmit all UID bits + BCC and receive a SAK - max 32 iterations.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        selectDone = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">while</span> (!selectDone) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="comment">// Find out how many bits and bytes to send and receive.</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> (currentLevelKnownBits &gt;= 32) { <span class="comment">// All UID bits in this Cascade Level are known. This is a SELECT.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="comment">//Serial.print(F(&quot;SELECT: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                buffer[1] = 0x70; <span class="comment">// NVB - Number of Valid Bits: Seven whole bytes</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <span class="comment">// Calculate BCC - Block Check Character</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                buffer[6] = buffer[2] ^ buffer[3] ^ buffer[4] ^ buffer[5];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <span class="comment">// Calculate CRC_A</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(buffer, 7, &amp;buffer[7]);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                txLastBits      = 0; <span class="comment">// 0 =&gt; All 8 bits are valid.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                bufferUsed      = 9;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="comment">// Store response in the last 3 bytes of buffer (BCC and CRC_A - not needed after tx)</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                responseBuffer  = &amp;buffer[6];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                responseLength  = 3;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">// This is an ANTICOLLISION.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="comment">//Serial.print(F(&quot;ANTICOLLISION: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                txLastBits      = currentLevelKnownBits % 8;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                count           = currentLevelKnownBits / 8;    <span class="comment">// Number of whole bytes in the UID part.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                index           = 2 + count;                    <span class="comment">// Number of whole bytes: SEL + NVB + UIDs</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                buffer[1]       = (index &lt;&lt; 4) + txLastBits;    <span class="comment">// NVB - Number of Valid Bits</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                bufferUsed      = index + (txLastBits ? 1 : 0);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="comment">// Store response in the unused part of buffer</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                responseBuffer  = &amp;buffer[index];</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                responseLength  = <span class="keyword">sizeof</span>(buffer) - index;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="comment">// Set bit adjustments</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            rxAlign = txLastBits;                                           <span class="comment">// Having a separate variable is overkill. But it makes the next line easier to read.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">PCD_WriteRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a3f2ed081137698e3d6c2c11dfd5129e4">BitFramingReg</a>, (rxAlign &lt;&lt; 4) + txLastBits);  <span class="comment">// RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="comment">// Transmit the buffer and receive the response.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">PCD_TransceiveData</a>(buffer, bufferUsed, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <span class="keywordflow">if</span> (result == <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7daa6a6fd953277959b0b8f5ea3fe9252fb">STATUS_COLLISION</a>) { <span class="comment">// More than one PICC in the field =&gt; collision.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                uint8_t valueOfCollReg = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">PCD_ReadRegister</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a55430b019624dd5a86e471c934139089">CollReg</a>); <span class="comment">// CollReg[7..0] bits are: ValuesAfterColl reserved CollPosNotValid CollPos[4:0]</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="keywordflow">if</span> (valueOfCollReg &amp; 0x20) { <span class="comment">// CollPosNotValid</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7daa6a6fd953277959b0b8f5ea3fe9252fb">STATUS_COLLISION</a>; <span class="comment">// Without a valid collision position we cannot continue</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                uint8_t collisionPos = valueOfCollReg &amp; 0x1F; <span class="comment">// Values 0-31, 0 means bit 32.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">if</span> (collisionPos == 0) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    collisionPos = 32;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="keywordflow">if</span> (collisionPos &lt;= currentLevelKnownBits) { <span class="comment">// No progress - should not happen </span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da956a658a552bd53d6e4ed59034d26411">STATUS_INTERNAL_ERROR</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="comment">// Choose the PICC with the bit set.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                currentLevelKnownBits   = collisionPos;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                count           = currentLevelKnownBits % 8; <span class="comment">// The bit to modify</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                checkBit        = (currentLevelKnownBits - 1) % 8;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                index           = 1 + (currentLevelKnownBits / 8) + (count ? 1 : 0); <span class="comment">// First byte is index 0.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                buffer[index]   |= (1 &lt;&lt; checkBit);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordflow">else</span> { <span class="comment">// STATUS_OK</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                <span class="keywordflow">if</span> (currentLevelKnownBits &gt;= 32) { <span class="comment">// This was a SELECT.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    selectDone = <span class="keyword">true</span>; <span class="comment">// No more anticollision </span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    <span class="comment">// We continue below outside the while.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                <span class="keywordflow">else</span> { <span class="comment">// This was an ANTICOLLISION.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    <span class="comment">// We now have all 32 bits of the UID in this Cascade Level</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    currentLevelKnownBits = 32;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    <span class="comment">// Run loop again to do the SELECT.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="comment">// We do not check the CBB - it was constructed by us above.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">// Copy the found UID bytes from buffer[] to uid-&gt;uidByte[]</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        index           = (buffer[2] == <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa426554eaf5c3a0b063718a1210fba91">PICC_CMD_CT</a>) ? 3 : 2; <span class="comment">// source index in buffer[]</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        bytesToCopy     = (buffer[2] == <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa426554eaf5c3a0b063718a1210fba91">PICC_CMD_CT</a>) ? 3 : 4;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">for</span> (count = 0; count &lt; bytesToCopy; count++) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            uid-&gt;uidByte[uidIndex + count] = buffer[index++];</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// Check response SAK (Select Acknowledge)</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> (responseLength != 3 || txLastBits != 0) { <span class="comment">// SAK must be exactly 24 bits (1 byte + CRC_A).</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">STATUS_ERROR</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// Verify CRC_A - do our own calculation and store the control in buffer[2..3] - those bytes are not needed anymore.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(responseBuffer, 1, &amp;buffer[2]);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> ((buffer[2] != responseBuffer[1]) || (buffer[3] != responseBuffer[2])) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da5c0024c0ea3716ace67cee7e8d4b280c">STATUS_CRC_WRONG</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span> (responseBuffer[0] &amp; 0x04) { <span class="comment">// Cascade bit set - UID not complete yes</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            cascadeLevel++;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            uidComplete = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            uid-&gt;<a class="code" href="struct_m_f_r_c_1_1_uid.html#a1c1b3c49727d7edeadf95756596c6599">sak</a> = responseBuffer[0];</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// Set correct uid-&gt;size</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    uid-&gt;<a class="code" href="struct_m_f_r_c_1_1_uid.html#aeb53e15a6acd08d613a607110ea39d35">size</a> = 3 * cascadeLevel + 1;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;}</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa33ab087fb7cb1fc34042f8289344ac0">  625</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa33ab087fb7cb1fc34042f8289344ac0">MFRC522::PICC_HaltA</a>() {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    uint8_t buffer[4];</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// Build command buffer</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    buffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa22f79c7e9f075ecedd4a0e0de180849">PICC_CMD_HLTA</a>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    buffer[1] = 0;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// Calculate CRC_A</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(buffer, 2, &amp;buffer[2]);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">// Send the command.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// The standard says:</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">//      If the PICC responds with any modulation during a period of 1 ms after the end of the frame containing the</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">//      HLTA command, this response shall be interpreted as &#39;not acknowledge&#39;.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// We interpret that this way: Only STATUS_TIMEOUT is a success.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">PCD_TransceiveData</a>(buffer, <span class="keyword">sizeof</span>(buffer), <span class="keyword">nullptr</span>, 0);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (result == <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">STATUS_TIMEOUT</a>) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (result == <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) { <span class="comment">// That is ironically NOT ok in this case ;-)</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">STATUS_ERROR</a>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;}</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a921dc080403ef79a61261cc0f6a6b6fe">  665</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a921dc080403ef79a61261cc0f6a6b6fe">MFRC522::PCD_Authenticate</a>(uint8_t command,     </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                            uint8_t blockAddr,     </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                            MIFARE_Key *key,    </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                            <a class="code" href="struct_m_f_r_c_1_1_uid.html">Uid</a> *uid            </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                                            ) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    uint8_t waitIRq = 0x10;        <span class="comment">// IdleIRq</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Build command buffer</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    uint8_t sendData[12];</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    sendData[0] = command;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    sendData[1] = blockAddr;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="namespace_m_f_r_c.html#acb976d651b6debeb47cbd94674c32765ac2a1614920cfbba759447daa7cd67830">MF_KEY_SIZE</a>; i++) {    <span class="comment">// 6 key bytes</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        sendData[2+i] = key-&gt;keyByte[i];</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">// Use the last uid bytes as specified in http://cache.nxp.com/documents/application_note/AN10927.pdf</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// section 3.2.5 &quot;MIFARE Classic Authentication&quot;.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// The only missed case is the MF1Sxxxx shortcut activation,</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// but it requires cascade tag (CT) byte, that is not part of uid.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 4; i++) {              <span class="comment">// The last 4 bytes of the UID</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        sendData[8+i] = uid-&gt;uidByte[i+uid-&gt;<a class="code" href="struct_m_f_r_c_1_1_uid.html#aeb53e15a6acd08d613a607110ea39d35">size</a>-4];</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// Start the authentication.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">PCD_CommunicateWithPICC</a>(<a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a897c2681312d8aae859a3e40c98e189e">PCD_MFAuthent</a>, waitIRq, &amp;sendData[0], <span class="keyword">sizeof</span>(sendData));</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;} <span class="comment">// End PCD_Authenticate()</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#acca1a078d263e61a1416ecab8bb2ac13">  691</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#acca1a078d263e61a1416ecab8bb2ac13">MFRC522::PCD_StopCrypto1</a>()</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;{</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">// Clear MFCrypto1On bit</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">PCD_ClearRegisterBitMask</a>(<a class="code" href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4c81dff53f5608e5e4eb93616699e953">Status2Reg</a>, 0x08); <span class="comment">// Status2Reg[7..0] bits are: TempSensClear I2CForceHS reserved reserved MFCrypto1On ModemState[2:0]</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;}</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#ac65521bb114da2206e265883bc3064b9">  713</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ac65521bb114da2206e265883bc3064b9">MFRC522::MIFARE_Read</a>(   uint8_t blockAddr,     </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                                            uint8_t *buffer,       </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                            uint8_t *bufferSize    </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                        ) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> result;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// Sanity check</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> (buffer == <span class="keyword">nullptr</span> || *bufferSize &lt; 18) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da98e879872e3b5f18fb1ad1cccc8a7bc8">STATUS_NO_ROOM</a>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// Build command buffer</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    buffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaf42d611a7ad2acd5178689b5bf26a778">PICC_CMD_MF_READ</a>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    buffer[1] = blockAddr;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Calculate CRC_A</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(buffer, 2, &amp;buffer[2]);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// Transmit the buffer and receive the response, validate CRC_A.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">PCD_TransceiveData</a>(buffer, 4, buffer, bufferSize, <span class="keyword">nullptr</span>, 0, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;} <span class="comment">// End MIFARE_Read()</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a80b19e0ca30b6915bef16a32c406cba8">  748</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a80b19e0ca30b6915bef16a32c406cba8">MFRC522::MIFARE_Write</a>(  uint8_t blockAddr, </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                            uint8_t *buffer,   </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                            uint8_t bufferSize </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                        ) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> result;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Sanity check</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">if</span> (buffer == <span class="keyword">nullptr</span> || bufferSize &lt; 16) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf">STATUS_INVALID</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// Mifare Classic protocol requires two communications to perform a write.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">// Step 1: Tell the PICC we want to write to block blockAddr.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    uint8_t cmdBuffer[2];</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    cmdBuffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba52a954ec02f4f4d1383c36695b3b008b">PICC_CMD_MF_WRITE</a>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    cmdBuffer[1] = blockAddr;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>(cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// Step 2: Transfer the data</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>(buffer, bufferSize); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;} <span class="comment">// End MIFARE_Write()</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6adf9557f47064a58263679330cea7f7">  778</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a6adf9557f47064a58263679330cea7f7">MFRC522::MIFARE_Ultralight_Write</a>(uint8_t page, uint8_t *buffer, uint8_t bufferSize)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;{</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// Sanity check</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (buffer == <span class="keyword">nullptr</span> || bufferSize &lt; 4) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf">STATUS_INVALID</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// Build commmand buffer</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    uint8_t cmdBuffer[6];</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    cmdBuffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba1125c6cff888ed24d21a4805587f5f8d">PICC_CMD_UL_WRITE</a>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    cmdBuffer[1] = page;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    memcpy(&amp;cmdBuffer[2], buffer, 4);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// Perform the write</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>(cmdBuffer, 6); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#ac5d7c4b94601999952124bb5961de535">  801</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ac5d7c4b94601999952124bb5961de535">MFRC522::MIFARE_Decrement</a>(uint8_t blockAddr, int32_t delta)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;{</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">MIFARE_TwoStepHelper</a>(<a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba4ae3a3dbd7e64ea9602a9eb3201a3f82">PICC_CMD_MF_DECREMENT</a>, blockAddr, delta);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7558f6f0e2eb1ec951db6cefbef582cb">  806</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7558f6f0e2eb1ec951db6cefbef582cb">MFRC522::MIFARE_Increment</a>(uint8_t blockAddr, int32_t delta)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;{</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">MIFARE_TwoStepHelper</a>(<a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebad2796b65da85f0e0d208d3eb255e6163">PICC_CMD_MF_INCREMENT</a>, blockAddr, delta);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#ad5f89901ec82b5b953703d9024b7b15b">  811</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ad5f89901ec82b5b953703d9024b7b15b">MFRC522::MIFARE_Restore</a>(uint8_t blockAddr)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;{</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="comment">// The datasheet describes Restore as a two step operation, but does not explain what data to transfer in step 2.</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Doing only a single step does not work, so I chose to transfer 0L in step two.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">MIFARE_TwoStepHelper</a>(<a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebac3a4530f4f6af9a2f2fb217171995d6d">PICC_CMD_MF_RESTORE</a>, blockAddr, 0L);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;}</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">  823</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">MFRC522::MIFARE_TwoStepHelper</a>(  uint8_t command,   </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                                    uint8_t blockAddr, </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                                    int32_t data        </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                                    ) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    uint8_t cmdBuffer[2]; <span class="comment">// We only need room for 2 bytes.</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="comment">// Step 1: Tell the PICC the command and block address</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    cmdBuffer[0] = command;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    cmdBuffer[1] = blockAddr;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>( cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// Step 2: Transfer the data</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>( (uint8_t *)&amp;data, 4, <span class="keyword">true</span>); <span class="comment">// Adds CRC_A and accept timeout as success.</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0d462097146d6675f85bc51883eb6669">  847</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0d462097146d6675f85bc51883eb6669">MFRC522::MIFARE_Transfer</a>(uint8_t blockAddr)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;{</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    uint8_t cmdBuffer[2]; <span class="comment">// We only need room for 2 bytes.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// Tell the PICC we want to transfer the result into block blockAddr.</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    cmdBuffer[0] = <a class="code" href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba69ba99a7a1638069a73161edb9ef2cda">PICC_CMD_MF_TRANSFER</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    cmdBuffer[1] = blockAddr;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">PCD_MIFARE_Transceive</a>( cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;}</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0bb344afd8234f3e0a845e1f0ceb6488">  862</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a0bb344afd8234f3e0a845e1f0ceb6488">MFRC522::MIFARE_GetValue</a>(uint8_t blockAddr, int32_t *value)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;{</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC522::StatusCode</a> status;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    uint8_t buffer[18];</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    uint8_t size = <span class="keyword">sizeof</span>(buffer);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// Read the block</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    status = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#ac65521bb114da2206e265883bc3064b9">MIFARE_Read</a>(blockAddr, buffer, &amp;size);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (status == <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="comment">// Extract the value</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        *value = (int32_t(buffer[3])&lt;&lt;24) | (int32_t(buffer[2])&lt;&lt;16) | (int32_t(buffer[1])&lt;&lt;8) | int32_t(buffer[0]);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;}</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1b8ea41dc9a828d2a1f01b0d03d4e21b">  877</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1b8ea41dc9a828d2a1f01b0d03d4e21b">MFRC522::MIFARE_SetValue</a>(uint8_t blockAddr, int32_t value)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;{</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    uint8_t buffer[18];</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// Translate the int32_t into 4 bytes; repeated 2x in value block</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    buffer[0] = buffer[ 8] = (value &amp; 0xFF);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    buffer[1] = buffer[ 9] = (value &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    buffer[2] = buffer[10] = (value &amp; 0xFF0000) &gt;&gt; 16;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    buffer[3] = buffer[11] = (value &amp; 0xFF000000) &gt;&gt; 24;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">// Inverse 4 bytes also found in value block</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    buffer[4] = ~buffer[0];</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    buffer[5] = ~buffer[1];</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    buffer[6] = ~buffer[2];</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    buffer[7] = ~buffer[3];</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="comment">// Address 2x with inverse address 2x</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    buffer[12] = buffer[14] = blockAddr;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    buffer[13] = buffer[15] = ~blockAddr;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="comment">// Write the whole data block</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a80b19e0ca30b6915bef16a32c406cba8">MIFARE_Write</a>(blockAddr, buffer, 16);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;}</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7789da2100091438b9ede0a73f50c2e3">  899</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a7789da2100091438b9ede0a73f50c2e3">MFRC522::PCD_NTAG216_AUTH</a>(uint8_t *passWord, uint8_t pACK[]) <span class="comment">//Authenticate with 32bit password</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;{</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="comment">// TODO: Fix cmdBuffer length and rxlength. They really should match.</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="comment">//       (Better still, rxlength should not even be necessary.)</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    uint8_t                cmdBuffer[18]; <span class="comment">// We need room for 16 bytes data and 2 bytes CRC_A.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    cmdBuffer[0] = 0x1B; <span class="comment">//Comando de autentificacion</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i&lt;4; i++)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        cmdBuffer[i+1] = passWord[i];</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(cmdBuffer, 5, &amp;cmdBuffer[5]);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (result!=<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="comment">// Transceive the data, store the reply in cmdBuffer[]</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    uint8_t waitIRq        = 0x30; <span class="comment">// RxIRq and IdleIRq</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">//  uint8_t cmdBufferSize  = sizeof(cmdBuffer);</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    uint8_t validBits      = 0;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    uint8_t rxlength       = 5;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">PCD_CommunicateWithPICC</a>(<a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12">PCD_Transceive</a>, waitIRq, cmdBuffer, 7, cmdBuffer, &amp;rxlength, &amp;validBits);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    pACK[0] = cmdBuffer[0];</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    pACK[1] = cmdBuffer[1];</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">if</span> (result!=<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;}</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">  935</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">MFRC522::PCD_MIFARE_Transceive</a>(uint8_t *sendData, uint8_t sendLen, <span class="keywordtype">bool</span> acceptTimeout)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;{</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">StatusCode</a> result;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    uint8_t cmdBuffer[18]; <span class="comment">// We need room for 16 bytes data and 2 bytes CRC_A.</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">// Sanity check</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">if</span> (sendData == <span class="keyword">nullptr</span> || sendLen &gt; 16) {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf">STATUS_INVALID</a>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">// Copy sendData[] to cmdBuffer[] and add CRC_A</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    memcpy(cmdBuffer, sendData, sendLen);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">PCD_CalculateCRC</a>(cmdBuffer, sendLen, &amp;cmdBuffer[sendLen]);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) { </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    sendLen += 2;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="comment">// Transceive the data, store the reply in cmdBuffer[]</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    uint8_t waitIRq = 0x30;        <span class="comment">// RxIRq and IdleIRq</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    uint8_t cmdBufferSize = <span class="keyword">sizeof</span>(cmdBuffer);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    uint8_t validBits = 0;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    result = <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">PCD_CommunicateWithPICC</a>(<a class="code" href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12">PCD_Transceive</a>, waitIRq, cmdBuffer, sendLen, cmdBuffer, &amp;cmdBufferSize, &amp;validBits);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">if</span> (acceptTimeout &amp;&amp; result == <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">STATUS_TIMEOUT</a>) {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">// The PICC must reply with a 4 bit ACK</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">if</span> (cmdBufferSize != 1 || validBits != 4) {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">STATUS_ERROR</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span> (cmdBuffer[0] != <a class="code" href="namespace_m_f_r_c.html#acb976d651b6debeb47cbd94674c32765a398a4deba15ef2c9b15f189e4331de4e">MF_ACK</a>) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dafef3c30148ab31624276e58198e067f2">STATUS_MIFARE_NACK</a>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">STATUS_OK</a>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;}</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a2cf9aa924afb6a23a35ed5beb1d9039e">  974</a></span>&#160;<a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3">PICC_Type</a> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a2cf9aa924afb6a23a35ed5beb1d9039e">MFRC522::PICC_GetType</a>(uint8_t sak)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;{</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// http://www.nxp.com/documents/application_note/AN10833.pdf </span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">// 3.2 Coding of Select Acknowledge (SAK)</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// ignore 8-bit (iso14443 starts with LSBit = bit 1)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// fixes wrong type for manufacturer Infineon (http://nfc-tools.org/index.php?title=ISO14443A)</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    sak &amp;= 0x7F;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">switch</span> (sak) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keywordflow">case</span> 0x04:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a6b52338cd2760084c92276cc78c7b600">PICC_TYPE_NOT_COMPLETE</a>;  <span class="comment">// UID not complete</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">case</span> 0x09:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a488c4169a7677239bf1296baff563814">PICC_TYPE_MIFARE_MINI</a>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keywordflow">case</span> 0x08:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3ac9a4295e85d3f118b7c142037c7f1de4">PICC_TYPE_MIFARE_1K</a>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">case</span> 0x18:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a0bd2b7a9ac57480e70eb39c4e6137809">PICC_TYPE_MIFARE_4K</a>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">case</span> 0x00:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a54f8d05b7713c1f0cf15cffbf3f89be5">PICC_TYPE_MIFARE_UL</a>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordflow">case</span> 0x10:</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">case</span> 0x11:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3ac9bb26aaea346bebae5c9ba6133f7d1c">PICC_TYPE_MIFARE_PLUS</a>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">case</span> 0x01:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a0957417cbc37f5c31ea33c61ecef3a4c">PICC_TYPE_TNP3XXX</a>;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">case</span> 0x20:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a9bad881b691501c598c91e7a6b17693d">PICC_TYPE_ISO_14443_4</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">case</span> 0x40:  <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3aae4287e368a87d0d1204582d0fa05e50">PICC_TYPE_ISO_18092</a>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">default</span>:    <span class="keywordflow">return</span> <a class="code" href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a78ef0193e23d765be56beaea584623be">PICC_TYPE_UNKNOWN</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;}</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div>
<div class="line"><a name="l00996"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a705ed68b27893cd174638415d3a65e94">  996</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a705ed68b27893cd174638415d3a65e94">MFRC522::MIFARE_SetAccessBits</a>(uint8_t *accessBitBuffer, uint8_t g0, uint8_t g1, uint8_t g2, uint8_t g3)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;{</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    uint8_t c1 = ((g3 &amp; 4) &lt;&lt; 1) | ((g2 &amp; 4) &lt;&lt; 0) | ((g1 &amp; 4) &gt;&gt; 1) | ((g0 &amp; 4) &gt;&gt; 2);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    uint8_t c2 = ((g3 &amp; 2) &lt;&lt; 2) | ((g2 &amp; 2) &lt;&lt; 1) | ((g1 &amp; 2) &lt;&lt; 0) | ((g0 &amp; 2) &gt;&gt; 1);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    uint8_t c3 = ((g3 &amp; 1) &lt;&lt; 3) | ((g2 &amp; 1) &lt;&lt; 2) | ((g1 &amp; 1) &lt;&lt; 1) | ((g0 &amp; 1) &lt;&lt; 0);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    accessBitBuffer[0] = (~c2 &amp; 0xF) &lt;&lt; 4 | (~c1 &amp; 0xF);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    accessBitBuffer[1] =          c1 &lt;&lt; 4 | (~c3 &amp; 0xF);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    accessBitBuffer[2] =          c3 &lt;&lt; 4 | c2;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;}</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1839f9049091b1c113ad4432768ac39e"> 1008</a></span>&#160;uint8_t <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#a1839f9049091b1c113ad4432768ac39e">MFRC522::readReg</a>(uint8_t reg)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;{</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">return</span> 0x80 | reg;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;}</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="class_m_f_r_c_1_1_m_f_r_c522.html#af72247c04ebbe81567957d859de31c46"> 1013</a></span>&#160;uint8_t <a class="code" href="class_m_f_r_c_1_1_m_f_r_c522.html#af72247c04ebbe81567957d859de31c46">MFRC522::writeReg</a>(uint8_t reg)</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;{</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">return</span> reg;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;} <span class="comment">/* namespace MFRC */</span></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a6c8f580c01ab6001603875bff483c9ef"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a6c8f580c01ab6001603875bff483c9ef">MFRC::PCDRegister::TxControlReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638">MFRC::PCDRegister</a></div><div class="ttdeci">PCDRegister</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00008">MFRC522.hpp:8</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638ae3d612e672d6744b5d42be5431051c4f"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae3d612e672d6744b5d42be5431051c4f">MFRC::PCDRegister::TxModeReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a6adf9557f47064a58263679330cea7f7"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a6adf9557f47064a58263679330cea7f7">MFRC::MFRC522::MIFARE_Ultralight_Write</a></div><div class="ttdeci">StatusCode MIFARE_Ultralight_Write(uint8_t page, uint8_t *buffer, uint8_t bufferSize)</div><div class="ttdoc">Writes a 4 byte page to the active MIFARE Ultralight PICC. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00778">MFRC522.cpp:778</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebaa22f79c7e9f075ecedd4a0e0de180849"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa22f79c7e9f075ecedd4a0e0de180849">MFRC::PICC_Command::PICC_CMD_HLTA</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a7558f6f0e2eb1ec951db6cefbef582cb"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a7558f6f0e2eb1ec951db6cefbef582cb">MFRC::MFRC522::MIFARE_Increment</a></div><div class="ttdeci">StatusCode MIFARE_Increment(uint8_t blockAddr, int32_t delta)</div><div class="ttdoc">MIFARE Increment adds the delta to the value of the addressed block, and stores the result in a volat...</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00806">MFRC522.cpp:806</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a0bd2b7a9ac57480e70eb39c4e6137809"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a0bd2b7a9ac57480e70eb39c4e6137809">MFRC::PICC_Type::PICC_TYPE_MIFARE_4K</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a705ed68b27893cd174638415d3a65e94"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a705ed68b27893cd174638415d3a65e94">MFRC::MFRC522::MIFARE_SetAccessBits</a></div><div class="ttdeci">void MIFARE_SetAccessBits(uint8_t *accessBitBuffer, uint8_t g0, uint8_t g1, uint8_t g2, uint8_t g3)</div><div class="ttdoc">Calculate the bit pattern needed for the specified access bits. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00996">MFRC522.cpp:996</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aec3e7879913ba9db625c715a538e5155"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aec3e7879913ba9db625c715a538e5155">MFRC::MFRC522::PCD_TransceiveData</a></div><div class="ttdeci">StatusCode PCD_TransceiveData(uint8_t *sendData, uint8_t sendLen, uint8_t *backData, uint8_t *backLen, uint8_t *validBits=nullptr, uint8_t rxAlign=0, bool checkCRC=false)</div><div class="ttdoc">Executes the Transceive command. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00297">MFRC522.cpp:297</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a55430b019624dd5a86e471c934139089"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a55430b019624dd5a86e471c934139089">MFRC::PCDRegister::CollReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1b8ea41dc9a828d2a1f01b0d03d4e21b"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1b8ea41dc9a828d2a1f01b0d03d4e21b">MFRC::MFRC522::MIFARE_SetValue</a></div><div class="ttdeci">StatusCode MIFARE_SetValue(uint8_t blockAddr, int32_t value)</div><div class="ttdoc">Helper routine to write a specific value into a Value Block. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00877">MFRC522.cpp:877</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3ac9a4295e85d3f118b7c142037c7f1de4"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3ac9a4295e85d3f118b7c142037c7f1de4">MFRC::PICC_Type::PICC_TYPE_MIFARE_1K</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a2e840a158b013e104751894b18493b59"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a2e840a158b013e104751894b18493b59">MFRC::MFRC522::_chipSelectPin</a></div><div class="ttdeci">uint8_t _chipSelectPin</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00526">MFRC522.hpp:526</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a7892fc58b473802b634afaefd31bbe00"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a7892fc58b473802b634afaefd31bbe00">MFRC::PCDRegister::DivIrqReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1bf8022c74614356b2b0350570bac64d"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1bf8022c74614356b2b0350570bac64d">MFRC::MFRC522::PCD_AntennaOn</a></div><div class="ttdeci">void PCD_AntennaOn()</div><div class="ttdoc">Turns the antenna on by enabling pins TX1 and TX2. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00165">MFRC522.cpp:165</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a3f2ed081137698e3d6c2c11dfd5129e4"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a3f2ed081137698e3d6c2c11dfd5129e4">MFRC::PCDRegister::BitFramingReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638aa66722964ad21187ec3874c513c04718"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638aa66722964ad21187ec3874c513c04718">MFRC::PCDRegister::ErrorReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a212643c14a322159fc706abdc0481912"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a212643c14a322159fc706abdc0481912">MFRC::PCDRegister::CRCResultRegL</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a11450bdf07b4ea5cc6ad0e81c8d44527">MFRC::PCDRegister::CommandReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac6cc4a82fbeef6086bf975cf2c2b4faf">MFRC::StatusCode::STATUS_OK</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3ac9bb26aaea346bebae5c9ba6133f7d1c"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3ac9bb26aaea346bebae5c9ba6133f7d1c">MFRC::PICC_Type::PICC_TYPE_MIFARE_PLUS</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7dafef3c30148ab31624276e58198e067f2"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dafef3c30148ab31624276e58198e067f2">MFRC::StatusCode::STATUS_MIFARE_NACK</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a1148f8c668fcd879ff66e69d3de5ef33"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a1148f8c668fcd879ff66e69d3de5ef33">MFRC::PCDRegister::ControlReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a31854b1a3968b9f91f90abd71e46cd55"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a31854b1a3968b9f91f90abd71e46cd55">MFRC::MFRC522::PCD_MIFARE_Transceive</a></div><div class="ttdeci">StatusCode PCD_MIFARE_Transceive(uint8_t *sendData, uint8_t sendLen, bool acceptTimeout=false)</div><div class="ttdoc">Wrapper for MIFARE protocol communication. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00935">MFRC522.cpp:935</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da7b8ea8ba0daa781605be2aae047212bf">MFRC::StatusCode::STATUS_INVALID</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a4f6e40cb3c6b57a699a623bd09d859fc"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a4f6e40cb3c6b57a699a623bd09d859fc">MFRC::MFRC522::PICC_RequestA</a></div><div class="ttdeci">StatusCode PICC_RequestA(uint8_t *bufferATQA, uint8_t *bufferSize)</div><div class="ttdoc">Transmits a REQuest command, Type A. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00389">MFRC522.cpp:389</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_ac5d7c4b94601999952124bb5961de535"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#ac5d7c4b94601999952124bb5961de535">MFRC::MFRC522::MIFARE_Decrement</a></div><div class="ttdeci">StatusCode MIFARE_Decrement(uint8_t blockAddr, int32_t delta)</div><div class="ttdoc">MIFARE Decrement subtracts the delta from the value of the addressed block, and stores the result in ...</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00801">MFRC522.cpp:801</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_af72247c04ebbe81567957d859de31c46"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#af72247c04ebbe81567957d859de31c46">MFRC::MFRC522::writeReg</a></div><div class="ttdeci">uint8_t writeReg(uint8_t reg)</div><div class="ttdoc">Automatically convert the given register address to be recognized as a writable location. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01013">MFRC522.cpp:1013</a></div></div>
<div class="ttc" id="struct_m_f_r_c_1_1_uid_html_a1c1b3c49727d7edeadf95756596c6599"><div class="ttname"><a href="struct_m_f_r_c_1_1_uid.html#a1c1b3c49727d7edeadf95756596c6599">MFRC::Uid::sak</a></div><div class="ttdeci">uint8_t sak</div><div class="ttdoc">The SAK byte returned from the PICC after successful selection. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00159">MFRC522.hpp:159</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a0be7e8b1c68eeedcfe4791c1f93311d8"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a0be7e8b1c68eeedcfe4791c1f93311d8">MFRC::PCDRegister::TModeReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_ad5f89901ec82b5b953703d9024b7b15b"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#ad5f89901ec82b5b953703d9024b7b15b">MFRC::MFRC522::MIFARE_Restore</a></div><div class="ttdeci">StatusCode MIFARE_Restore(uint8_t blockAddr)</div><div class="ttdoc">MIFARE Restore copies the value of the addressed block into a volatile memory. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00811">MFRC522.cpp:811</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a5c1d7d189a703ace5301ce9abfa9faf9">MFRC::PCDRegister::FIFOLevelReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a237cdeaf894c23f3b97eccb8b1bb1479"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a237cdeaf894c23f3b97eccb8b1bb1479">MFRC::PCDRegister::TPrescalerReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebae622566f65077706b3fabbe057ac931a"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebae622566f65077706b3fabbe057ac931a">MFRC::PICC_Command::PICC_CMD_SEL_CL2</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7da5c0024c0ea3716ace67cee7e8d4b280c"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da5c0024c0ea3716ace67cee7e8d4b280c">MFRC::StatusCode::STATUS_CRC_WRONG</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638ae16c48cbed59486a669365b7f40150ab"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae16c48cbed59486a669365b7f40150ab">MFRC::PCDRegister::TReloadRegL</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_acca1a078d263e61a1416ecab8bb2ac13"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#acca1a078d263e61a1416ecab8bb2ac13">MFRC::MFRC522::PCD_StopCrypto1</a></div><div class="ttdeci">void PCD_StopCrypto1()</div><div class="ttdoc">Used to exit the PCD from its authenticated state. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00691">MFRC522.cpp:691</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebac3a4530f4f6af9a2f2fb217171995d6d"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebac3a4530f4f6af9a2f2fb217171995d6d">MFRC::PICC_Command::PICC_CMD_MF_RESTORE</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638aaf12350510a933a6f206df6b61ca2f50"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638aaf12350510a933a6f206df6b61ca2f50">MFRC::PCDRegister::TxASKReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a1db3ec7619e0d21b8dfb996d4ddeeda4"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a1db3ec7619e0d21b8dfb996d4ddeeda4">MFRC::PCDRegister::ComIrqReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a0d462097146d6675f85bc51883eb6669"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a0d462097146d6675f85bc51883eb6669">MFRC::MFRC522::MIFARE_Transfer</a></div><div class="ttdeci">StatusCode MIFARE_Transfer(uint8_t blockAddr)</div><div class="ttdoc">MIFARE Transfer writes the value stored in the volatile memory into one MIFARE Classic block...</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00847">MFRC522.cpp:847</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_acb976d651b6debeb47cbd94674c32765ac2a1614920cfbba759447daa7cd67830"><div class="ttname"><a href="namespace_m_f_r_c.html#acb976d651b6debeb47cbd94674c32765ac2a1614920cfbba759447daa7cd67830">MFRC::MIFARE_Misc::MF_KEY_SIZE</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba69ba99a7a1638069a73161edb9ef2cda"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba69ba99a7a1638069a73161edb9ef2cda">MFRC::PICC_Command::PICC_CMD_MF_TRANSFER</a></div></div>
<div class="ttc" id="struct_m_f_r_c_1_1_uid_html_aeb53e15a6acd08d613a607110ea39d35"><div class="ttname"><a href="struct_m_f_r_c_1_1_uid.html#aeb53e15a6acd08d613a607110ea39d35">MFRC::Uid::size</a></div><div class="ttdeci">uint8_t size</div><div class="ttdoc">The number of bytes in the UID. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00157">MFRC522.hpp:157</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a54f8d05b7713c1f0cf15cffbf3f89be5"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a54f8d05b7713c1f0cf15cffbf3f89be5">MFRC::PICC_Type::PICC_TYPE_MIFARE_UL</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aa7ca9492ee1ddcda650310dc07961714"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aa7ca9492ee1ddcda650310dc07961714">MFRC::MFRC522::MIFARE_TwoStepHelper</a></div><div class="ttdeci">StatusCode MIFARE_TwoStepHelper(uint8_t command, uint8_t blockAddr, int32_t data)</div><div class="ttdoc">Helper function for the two-step MIFARE Classic protocol operations Decrement, Increment and Restore...</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00823">MFRC522.cpp:823</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a7977fc7aca1707b43acec4d7a10239fe"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a7977fc7aca1707b43acec4d7a10239fe">MFRC::MFRC522::PCD_Init</a></div><div class="ttdeci">void PCD_Init()</div><div class="ttdoc">Initialize the MFRC522 chip. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00100">MFRC522.cpp:100</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a81ead771fb7925af374f84962a1b118f"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a81ead771fb7925af374f84962a1b118f">MFRC::MFRC522::PCD_SetAntennaGain</a></div><div class="ttdeci">void PCD_SetAntennaGain(uint8_t mask)</div><div class="ttdoc">Set the MFRC522 Receiver Gain (RxGain) to value specified by given mask. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00183">MFRC522.cpp:183</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba7c2b5038b9c5f7edb7b9ea0e54d85360"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba7c2b5038b9c5f7edb7b9ea0e54d85360">MFRC::PICC_Command::PICC_CMD_SEL_CL1</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_ac65521bb114da2206e265883bc3064b9"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#ac65521bb114da2206e265883bc3064b9">MFRC::MFRC522::MIFARE_Read</a></div><div class="ttdeci">StatusCode MIFARE_Read(uint8_t blockAddr, uint8_t *buffer, uint8_t *bufferSize)</div><div class="ttdoc">Reads 16 bytes (+ 2 bytes CRC_A) from the active PICC. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00713">MFRC522.cpp:713</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a405f8573d81d63d4dedbdb45c40f816c"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a405f8573d81d63d4dedbdb45c40f816c">MFRC::PCDRegister::CRCResultRegH</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba61672bf29f6679232850bc7c724a6868"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba61672bf29f6679232850bc7c724a6868">MFRC::PICC_Command::PICC_CMD_WUPA</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a9ff9256cf4bb95b3434218c6eec62cb1"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a9ff9256cf4bb95b3434218c6eec62cb1">MFRC::PCDRegister::AutoTestReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a2e8033091c806e68d5715040aa056a03"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a2e8033091c806e68d5715040aa056a03">MFRC::PCDRegister::RFCfgReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebaf42d611a7ad2acd5178689b5bf26a778"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaf42d611a7ad2acd5178689b5bf26a778">MFRC::PICC_Command::PICC_CMD_MF_READ</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84a285acb7d0736b5afc92ea6560fe329be"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a285acb7d0736b5afc92ea6560fe329be">MFRC::PCD_Command::PCD_Mem</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638ae85967fc09d21a10fdf99a2717c7f3f6"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638ae85967fc09d21a10fdf99a2717c7f3f6">MFRC::PCDRegister::ModWidthReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84a05f524febfef65b7f8254e3fcadf0f34"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a05f524febfef65b7f8254e3fcadf0f34">MFRC::PCD_Command::PCD_SoftReset</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a0e85af574de32cd21c41fa6de7bbdff5"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a0e85af574de32cd21c41fa6de7bbdff5">MFRC::MFRC522::PICC_Select</a></div><div class="ttdeci">virtual StatusCode PICC_Select(Uid *uid, uint8_t validBits=0)</div><div class="ttdoc">Transmits SELECT/ANTICOLLISION commands to select a single PICC. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00419">MFRC522.cpp:419</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aaaa8197345d434273f673318abba1d0f"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aaaa8197345d434273f673318abba1d0f">MFRC::MFRC522::PCD_SoftPowerDown</a></div><div class="ttdeci">void PCD_SoftPowerDown()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00273">MFRC522.cpp:273</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7da98e879872e3b5f18fb1ad1cccc8a7bc8"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da98e879872e3b5f18fb1ad1cccc8a7bc8">MFRC::StatusCode::STATUS_NO_ROOM</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a0957417cbc37f5c31ea33c61ecef3a4c"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a0957417cbc37f5c31ea33c61ecef3a4c">MFRC::PICC_Type::PICC_TYPE_TNP3XXX</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da30585812a47076d2113e2fbfe88357a5">MFRC::StatusCode::STATUS_TIMEOUT</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3">MFRC::PICC_Type</a></div><div class="ttdeci">PICC_Type</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00128">MFRC522.hpp:128</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1408fd1b9df3230f04609515ae28780a"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1408fd1b9df3230f04609515ae28780a">MFRC::MFRC522::PCD_PerformSelfTest</a></div><div class="ttdeci">bool PCD_PerformSelfTest()</div><div class="ttdoc">Performs a self-test of the MFRC522 See 16.1.1 in http://www.nxp.com/documents/data_sheet/MFRC522.pdf. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00191">MFRC522.cpp:191</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a6b52338cd2760084c92276cc78c7b600"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a6b52338cd2760084c92276cc78c7b600">MFRC::PICC_Type::PICC_TYPE_NOT_COMPLETE</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a4c239ecd6090284f00aaf1770acca869"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4c239ecd6090284f00aaf1770acca869">MFRC::PCDRegister::VersionReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_abed43235e1d1b3f809af2af4fb654d34"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#abed43235e1d1b3f809af2af4fb654d34">MFRC::MFRC522::_resetPowerDownPin</a></div><div class="ttdeci">uint8_t _resetPowerDownPin</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00527">MFRC522.hpp:527</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a6be478d423220af7b54db63c362a6902"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a6be478d423220af7b54db63c362a6902">MFRC::MFRC522::PCD_WriteRegister</a></div><div class="ttdeci">void PCD_WriteRegister(PCDRegister reg, uint8_t value)</div><div class="ttdoc">Writes a byte to the specified register in the MFRC522 chip. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00004">MFRC522.cpp:4</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebab7de94a76a70fae4499445c2c48c9add"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebab7de94a76a70fae4499445c2c48c9add">MFRC::PICC_Command::PICC_CMD_REQA</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a78ef0193e23d765be56beaea584623be"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a78ef0193e23d765be56beaea584623be">MFRC::PICC_Type::PICC_TYPE_UNKNOWN</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84a897c2681312d8aae859a3e40c98e189e"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a897c2681312d8aae859a3e40c98e189e">MFRC::PCD_Command::PCD_MFAuthent</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aa33ab087fb7cb1fc34042f8289344ac0"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aa33ab087fb7cb1fc34042f8289344ac0">MFRC::MFRC522::PICC_HaltA</a></div><div class="ttdeci">StatusCode PICC_HaltA()</div><div class="ttdoc">Instructs a PICC in state ACTIVE(*) to go to state HALT. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00625">MFRC522.cpp:625</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a4c81dff53f5608e5e4eb93616699e953"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4c81dff53f5608e5e4eb93616699e953">MFRC::PCDRegister::Status2Reg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3aae4287e368a87d0d1204582d0fa05e50"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3aae4287e368a87d0d1204582d0fa05e50">MFRC::PICC_Type::PICC_TYPE_ISO_18092</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebaa426554eaf5c3a0b063718a1210fba91"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebaa426554eaf5c3a0b063718a1210fba91">MFRC::PICC_Command::PICC_CMD_CT</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a488c4169a7677239bf1296baff563814"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a488c4169a7677239bf1296baff563814">MFRC::PICC_Type::PICC_TYPE_MIFARE_MINI</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7daa6a6fd953277959b0b8f5ea3fe9252fb"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7daa6a6fd953277959b0b8f5ea3fe9252fb">MFRC::StatusCode::STATUS_COLLISION</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aa4b4606785e6d0fac5de0b7c5c33634b"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aa4b4606785e6d0fac5de0b7c5c33634b">MFRC::MFRC522::PCD_ClearRegisterBitMask</a></div><div class="ttdeci">void PCD_ClearRegisterBitMask(PCDRegister reg, uint8_t mask)</div><div class="ttdoc">Clears the bits given in mask from register reg. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00066">MFRC522.cpp:66</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a80b19e0ca30b6915bef16a32c406cba8"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a80b19e0ca30b6915bef16a32c406cba8">MFRC::MFRC522::MIFARE_Write</a></div><div class="ttdeci">StatusCode MIFARE_Write(uint8_t blockAddr, uint8_t *buffer, uint8_t bufferSize)</div><div class="ttdoc">Writes 16 bytes to the active PICC. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00748">MFRC522.cpp:748</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638acd32b2f19f1ff8fa06c27e80905889db"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638acd32b2f19f1ff8fa06c27e80905889db">MFRC::PCDRegister::TReloadRegH</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7da956a658a552bd53d6e4ed59034d26411"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7da956a658a552bd53d6e4ed59034d26411">MFRC::StatusCode::STATUS_INTERNAL_ERROR</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a0bb344afd8234f3e0a845e1f0ceb6488"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a0bb344afd8234f3e0a845e1f0ceb6488">MFRC::MFRC522::MIFARE_GetValue</a></div><div class="ttdeci">StatusCode MIFARE_GetValue(uint8_t blockAddr, int32_t *value)</div><div class="ttdoc">Helper routine to read the current value from a Value Block. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00862">MFRC522.cpp:862</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba4ae3a3dbd7e64ea9602a9eb3201a3f82"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba4ae3a3dbd7e64ea9602a9eb3201a3f82">MFRC::PICC_Command::PICC_CMD_MF_DECREMENT</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a414e7dd52abf129e38a3fd7502e0deda"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a414e7dd52abf129e38a3fd7502e0deda">MFRC::MFRC522::PICC_WakeupA</a></div><div class="ttdeci">StatusCode PICC_WakeupA(uint8_t *bufferATQA, uint8_t *bufferSize)</div><div class="ttdoc">Transmits a Wake-UP command, Type A. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00394">MFRC522.cpp:394</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7d"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7d">MFRC::StatusCode</a></div><div class="ttdeci">StatusCode</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00144">MFRC522.hpp:144</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1"><div class="ttname"><a href="namespace_m_f_r_c.html#a72766ea6443003b5ca58e0f38dff2e7dac01289a7e6e2f258f7de3f16399fd5f1">MFRC::StatusCode::STATUS_ERROR</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba1125c6cff888ed24d21a4805587f5f8d"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba1125c6cff888ed24d21a4805587f5f8d">MFRC::PICC_Command::PICC_CMD_UL_WRITE</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a4130d37867b7dd3c1b02f59bf6959cb1"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a4130d37867b7dd3c1b02f59bf6959cb1">MFRC::PCDRegister::RxModeReg</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a57b98d38ff9e306540e228a822dffcf3a9bad881b691501c598c91e7a6b17693d"><div class="ttname"><a href="namespace_m_f_r_c.html#a57b98d38ff9e306540e228a822dffcf3a9bad881b691501c598c91e7a6b17693d">MFRC::PICC_Type::PICC_TYPE_ISO_14443_4</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a7789da2100091438b9ede0a73f50c2e3"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a7789da2100091438b9ede0a73f50c2e3">MFRC::MFRC522::PCD_NTAG216_AUTH</a></div><div class="ttdeci">StatusCode PCD_NTAG216_AUTH(uint8_t *passWord, uint8_t pACK[])</div><div class="ttdoc">Authenticate with a NTAG216. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00899">MFRC522.cpp:899</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84a735f791b9d06b34d9a2644ff4da4d303">MFRC::PCD_Command::PCD_Idle</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a921dc080403ef79a61261cc0f6a6b6fe"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a921dc080403ef79a61261cc0f6a6b6fe">MFRC::MFRC522::PCD_Authenticate</a></div><div class="ttdeci">StatusCode PCD_Authenticate(uint8_t command, uint8_t blockAddr, MIFARE_Key *key, Uid *uid)</div><div class="ttdoc">Executes the MFRC522 MFAuthent command. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00665">MFRC522.cpp:665</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84ab6d5e8852271ce88cdc8645f18b0a0a4"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84ab6d5e8852271ce88cdc8645f18b0a0a4">MFRC::PCD_Command::PCD_CalcCRC</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a59fee5d1bf21991422badc312152c49a"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a59fee5d1bf21991422badc312152c49a">MFRC::MFRC522::PCD_CommunicateWithPICC</a></div><div class="ttdeci">StatusCode PCD_CommunicateWithPICC(uint8_t command, uint8_t waitIRq, uint8_t *sendData, uint8_t sendLen, uint8_t *backData=nullptr, uint8_t *backLen=nullptr, uint8_t *validBits=nullptr, uint8_t rxAlign=0, bool checkCRC=false)</div><div class="ttdoc">Transfers data to the MFRC522 FIFO, executes a command, waits for completion and transfers data back ...</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00303">MFRC522.cpp:303</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_aa627ac387b7b81a55eb65d69f0d6cd51"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#aa627ac387b7b81a55eb65d69f0d6cd51">MFRC::MFRC522::PCD_Reset</a></div><div class="ttdeci">void PCD_Reset()</div><div class="ttdoc">Perform a soft reset on the MFRC522 chip and wait for it to be ready again. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00152">MFRC522.cpp:152</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1839f9049091b1c113ad4432768ac39e"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1839f9049091b1c113ad4432768ac39e">MFRC::MFRC522::readReg</a></div><div class="ttdeci">uint8_t readReg(uint8_t reg)</div><div class="ttdoc">Automatically convert the given register address to be recognized as a readable location. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01008">MFRC522.cpp:1008</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a60bd31a2011cb66ebd99f660ba7b5d69"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a60bd31a2011cb66ebd99f660ba7b5d69">MFRC::MFRC522::PCD_GetAntennaGain</a></div><div class="ttdeci">uint8_t PCD_GetAntennaGain()</div><div class="ttdoc">Get the current MFRC522 Receiver Gain (RxGain[2:0]) value. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00178">MFRC522.cpp:178</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_abc5785a1ab77bfef495a18b8be64d716"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#abc5785a1ab77bfef495a18b8be64d716">MFRC::MFRC522::PCD_SoftPowerUp</a></div><div class="ttdeci">void PCD_SoftPowerUp()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00281">MFRC522.cpp:281</a></div></div>
<div class="ttc" id="_m_f_r_c522_8hpp_html"><div class="ttname"><a href="_m_f_r_c522_8hpp.html">MFRC522.hpp</a></div></div>
<div class="ttc" id="struct_m_f_r_c_1_1_uid_html"><div class="ttname"><a href="struct_m_f_r_c_1_1_uid.html">MFRC::Uid</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8hpp_source.html#l00156">MFRC522.hpp:156</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebad2796b65da85f0e0d208d3eb255e6163"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebad2796b65da85f0e0d208d3eb255e6163">MFRC::PICC_Command::PICC_CMD_MF_INCREMENT</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a2cf9aa924afb6a23a35ed5beb1d9039e"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a2cf9aa924afb6a23a35ed5beb1d9039e">MFRC::MFRC522::PICC_GetType</a></div><div class="ttdeci">PICC_Type PICC_GetType(uint8_t sak)</div><div class="ttdoc">Translates the SAK (Select Acknowledge) to a PICC type. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00974">MFRC522.cpp:974</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a8ef9fd587fd6567688f467a414073432">MFRC::PCDRegister::FIFODataReg</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a31a393a1dff186ad19d31f9e02ee4e78"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a31a393a1dff186ad19d31f9e02ee4e78">MFRC::MFRC522::PCD_ReadRegister</a></div><div class="ttdeci">uint8_t PCD_ReadRegister(PCDRegister reg)</div><div class="ttdoc">Reads a byte from the specified register in the MFRC522 chip. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00022">MFRC522.cpp:22</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3ebab63546886f438df42f2132ae2d2f8828"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3ebab63546886f438df42f2132ae2d2f8828">MFRC::PICC_Command::PICC_CMD_SEL_CL3</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12"><div class="ttname"><a href="namespace_m_f_r_c.html#a794a854adc67b84c09a6b42da40b2b84af5e55ac1eff2ec93fac7fd8a3e44aa12">MFRC::PCD_Command::PCD_Transceive</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1993a4ebe1f303f2ade7ca51da3e6771"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1993a4ebe1f303f2ade7ca51da3e6771">MFRC::MFRC522::PCD_CalculateCRC</a></div><div class="ttdeci">StatusCode PCD_CalculateCRC(uint8_t *data, uint8_t length, uint8_t *result)</div><div class="ttdoc">Use the CRC coprocessor in the MFRC522 to calculate a CRC_A. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00073">MFRC522.cpp:73</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a1ec04dca980c7cfcad234fb74f241369"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a1ec04dca980c7cfcad234fb74f241369">MFRC::MFRC522::PCD_AntennaOff</a></div><div class="ttdeci">void PCD_AntennaOff()</div><div class="ttdoc">Turns the antenna off by disabling pins TX1 and TX2. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00173">MFRC522.cpp:173</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_a6d6f1dcbfede41160cc84085b08c2fbe"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#a6d6f1dcbfede41160cc84085b08c2fbe">MFRC::MFRC522::PICC_REQA_or_WUPA</a></div><div class="ttdeci">StatusCode PICC_REQA_or_WUPA(uint8_t command, uint8_t *bufferATQA, uint8_t *bufferSize)</div><div class="ttdoc">Transmits REQA or WUPA commands. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00399">MFRC522.cpp:399</a></div></div>
<div class="ttc" id="class_m_f_r_c_1_1_m_f_r_c522_html_ae67c3d632e2cd9f02c79d5ab04e3b6d7"><div class="ttname"><a href="class_m_f_r_c_1_1_m_f_r_c522.html#ae67c3d632e2cd9f02c79d5ab04e3b6d7">MFRC::MFRC522::PCD_SetRegisterBitMask</a></div><div class="ttdeci">void PCD_SetRegisterBitMask(PCDRegister reg, uint8_t mask)</div><div class="ttdoc">Perform a bitwise OR on the given register. </div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00059">MFRC522.cpp:59</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a859b095bdc75d73a4185f8e8a5e2d3eba52a954ec02f4f4d1383c36695b3b008b"><div class="ttname"><a href="namespace_m_f_r_c.html#a859b095bdc75d73a4185f8e8a5e2d3eba52a954ec02f4f4d1383c36695b3b008b">MFRC::PICC_Command::PICC_CMD_MF_WRITE</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_acb976d651b6debeb47cbd94674c32765a398a4deba15ef2c9b15f189e4331de4e"><div class="ttname"><a href="namespace_m_f_r_c.html#acb976d651b6debeb47cbd94674c32765a398a4deba15ef2c9b15f189e4331de4e">MFRC::MIFARE_Misc::MF_ACK</a></div></div>
<div class="ttc" id="namespace_m_f_r_c_html_a2da467e59aa8c879edcc6aa3c9209638a23737bf73ba9ce1cd431609c8ad992c4"><div class="ttname"><a href="namespace_m_f_r_c.html#a2da467e59aa8c879edcc6aa3c9209638a23737bf73ba9ce1cd431609c8ad992c4">MFRC::PCDRegister::ModeReg</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_m_f_r_c522_8cpp.html">MFRC522.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
